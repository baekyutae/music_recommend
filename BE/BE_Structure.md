# VibeCurator λ°±μ—”λ“ νμΌ κµ¬μ΅° λ° κΈ°λ¥ μ„¤λ…

---

## π“ ν”„λ΅μ νΈ κµ¬μ΅°

```
BE/
β”β”€β”€ .env                    # ν™κ²½λ³€μ (κ²½λ΅, νλΌλ―Έν„° μ„¤μ •)
β”β”€β”€ requirements.txt        # Python μμ΅΄μ„± λ©λ΅
β”‚
β””β”€β”€ app/
    β”β”€β”€ __init__.py
    β”β”€β”€ main.py             # FastAPI μ•± μƒμ„± + λΌμ΄ν”„μ‚¬μ΄ν΄ κ΄€λ¦¬
    β”‚
    β”β”€β”€ api/                # API λΌμ°ν„°
    β”‚   β”β”€β”€ routes_health.py    # ν—¬μ¤μ²΄ν¬ μ—”λ“ν¬μΈνΈ
    β”‚   β”β”€β”€ routes_songs.py     # κ³΅ κ²€μƒ‰/μ΅°ν μ—”λ“ν¬μΈνΈ
    β”‚   β””β”€β”€ routes_recommend.py # μ¶”μ² API μ—”λ“ν¬μΈνΈ
    β”‚
    β”β”€β”€ core/               # ν•µμ‹¬ λΉ„μ¦λ‹μ¤ λ΅μ§
    β”‚   β”β”€β”€ config.py       # μ„¤μ • λ΅λ“ (ν™κ²½λ³€μ β†’ Settings)
    β”‚   β”β”€β”€ loaders.py      # λ°μ΄ν„° λ΅λ” (λ©”νƒ€/λ¨λΈ/μ„λ² λ”©)
    β”‚   β”β”€β”€ engine.py       # μ¶”μ² μ—”μ§„ (Stage3 ν•μ΄λΈλ¦¬λ“)
    β”‚   β”β”€β”€ scoring.py      # μ¤μ½”μ–΄λ§ μ ν‹Έ (Stage1.5 + ν•μ΄λΈλ¦¬λ“)
    β”‚   β””β”€β”€ cache.py        # Redis μΊμ‹ μ ν‹Έ
    β”‚
    β”β”€β”€ schemas/            # Pydantic μ¤ν‚¤λ§ (μ”μ²­/μ‘λ‹µ λ¨λΈ)
    β”‚   β”β”€β”€ common.py       # κ³µν†µ μ¤ν‚¤λ§ (ErrorResponse λ“±)
    β”‚   β”β”€β”€ recommend.py    # μ¶”μ² API μ¤ν‚¤λ§
    β”‚   β””β”€β”€ songs.py        # κ³΅ μ΅°ν μ¤ν‚¤λ§
    β”‚
    β””β”€β”€ utils/              # κ³µν†µ μ ν‹Έλ¦¬ν‹°
        β”β”€β”€ logging.py      # λ΅κΉ… μ„¤μ •
        β””β”€β”€ timing.py       # μ„±λ¥ μΈ΅μ • λ°μ½”λ μ΄ν„°
```

---

## π”— API μ—”λ“ν¬μΈνΈ

| Method | Endpoint | μ„¤λ… |
|--------|----------|------|
| `GET` | `/` | μ„λΉ„μ¤ μ •λ³΄ (λ²„μ „, docs λ§ν¬) |
| `GET` | `/health` | ν—¬μ¤μ²΄ν¬ (λ¦¬μ†μ¤ λ΅λ“ μƒνƒ) |
| `GET` | `/recommend` | **κ³΅ μ¶”μ²** (`seed_id`, `k` νλΌλ―Έν„°) |
| `GET` | `/songs/{song_id}` | κ³΅ μ •λ³΄ μ΅°ν |
| `GET` | `/songs/search` | κ³΅ κ²€μƒ‰ |

---

## π€ μ¶”μ² νμ΄ν”„λΌμΈ (Stage3 ν•μ΄λΈλ¦¬λ“)

```
μ‹λ“ κ³΅ μ…λ ¥
    β”‚
    β–Ό
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ Stage1: Item2Vec CF ν›„λ³΄ μƒμ„± β”‚  β† ν‘μ—… ν•„ν„°λ§μΌλ΅ μ μ‚¬κ³΅ μ¶”μ¶
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    β”‚
    β–Ό
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ Stage1.5: Re-ranking         β”‚
β”‚  β”β”€ μ•„ν‹°μ¤νΈ μ†ν”„νΈ νλ„ν‹°    β”‚  β† λ™μΌ μ•„ν‹°μ¤νΈ κ³Όλ‹¤ μ¶ν„ λ°©μ§€
β”‚  β”β”€ μ¥λ¥΄ λ μΌκ°€λ“            β”‚  β† μ‹λ“μ™€ λ‹¤λ¥Έ μ¥λ¥΄ νλ„ν‹°
β”‚  β””β”€ μ•„ν‹°μ¤νΈ ν•λ“μ»·          β”‚  β† μ•„ν‹°μ¤νΈλ‹Ή μµλ€ Nκ³΅ μ ν•
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    β”‚
    β–Ό
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ Stage3: ν•μ΄λΈλ¦¬λ“ μ¤μ½”μ–΄λ§   β”‚
β”‚  score = Ξ± Γ— CF + Ξ² Γ— Audio  β”‚  β† CF + μ¤λ””μ¤ μ„λ² λ”© κ²°ν•©
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    β”‚
    β–Ό
μ¶”μ² κ²°κ³Ό λ°ν™
```

---

## π“¦ μ£Όμ” λ¨λ“ μ„¤λ…

### `main.py`
- FastAPI μ•± μƒμ„± λ° CORS μ„¤μ •
- λΌμ΄ν”„μ‚¬μ΄ν΄(`lifespan`)μ—μ„ λ¨λ“  λ¦¬μ†μ¤ λ΅λ“
- λΌμ°ν„° λ“±λ΅ (`routes_health`, `routes_songs`, `routes_recommend`)

### `core/loaders.py`
- `load_song_meta_melon()` - Melon κ³΅ λ©”νƒ€λ°μ΄ν„° λ΅λ“
- `load_audio_song_meta()` - μ¤λ””μ¤ λ©”νƒ€λ°μ΄ν„° λ΅λ“
- `load_item2vec_model()` - Item2Vec λ¨λΈ λ΅λ“
- `load_audio_embeddings()` - μ¤λ””μ¤ μ„λ² λ”©(Myna/CNN) λ΅λ“
- `MetaRegistry`, `AudioBundle` λ°μ΄ν„° ν΄λμ¤

### `core/engine.py`
- `RecommendationEngine` ν΄λμ¤
- `recommend(seed_id, k)` - μ¶”μ² μ‹¤ν–‰ (Stage3 νμ΄ν”„λΌμΈ)
- CF ν›„λ³΄ μƒμ„± β†’ Re-ranking β†’ ν•μ΄λΈλ¦¬λ“ μ¤μ½”μ–΄λ§

### `core/scoring.py`
- `batch_cosine_similarity()` - λ²΅ν„° μ μ‚¬λ„ κ³„μ‚°
- `minmax_normalize()` - μ μ μ •κ·ν™”
- `apply_stage1_5_reranking()` - Stage1.5 μ „μ²΄ νμ΄ν”„λΌμΈ
- `compute_hybrid_scores()` - CF + Audio ν•μ΄λΈλ¦¬λ“ μ μ κ³„μ‚°

### `core/cache.py`
- Redis μΊμ‹ λνΌ
- μ¶”μ² κ²°κ³Ό μΊμ‹±μΌλ΅ μ‘λ‹µ μ†λ„ ν–¥μƒ

---

## β™οΈ ν™κ²½λ³€μ (.env)

| λ³€μ | μ„¤λ… |
|------|------|
| `SONG_META_PATH` | song_meta.json κ²½λ΅ |
| `ITEM2VEC_PATH` | Item2Vec λ¨λΈ κ²½λ΅ |
| `AUDIO_EMB_MYNA_PATH` | Myna μ¤λ””μ¤ μ„λ² λ”© κ²½λ΅ |
| `AUDIO_MODEL` | μ‚¬μ©ν•  μ¤λ””μ¤ λ¨λΈ (`myna` / `cnn`) |
| `ALPHA_AUDIO` | ν•μ΄λΈλ¦¬λ“ κ°€μ¤‘μΉ (Ξ², μ¤λ””μ¤ λΉ„μ¤‘) |
| `REDIS_URL` | Redis μ—°κ²° URL |
| `DEMO_MODE` | λ°λ¨ λ¨λ“ (λ¦¬μ†μ¤ μ—†μ΄ λ”λ―Έ μ‘λ‹µ) |

---

## πƒ μ‹¤ν–‰ λ°©λ²•

```bash
cd BE
pip install -r requirements.txt
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

API λ¬Έμ„: `http://localhost:8000/docs`
